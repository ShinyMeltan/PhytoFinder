<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PhytoFinder</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; }
  h1 { text-align: center; }
  .plants, .results { margin-top: 20px; }
  label { display: block; margin: 5px 0; cursor: pointer; }
  button { margin-top: 20px; padding: 10px 15px; font-size: 1rem; }
  .results { font-weight: bold; }
  #search-container { position: relative; }
  #plant-search { width: 100%; padding: 8px; font-size: 1rem; box-sizing: border-box; }
  #suggestions { 
    position: absolute; 
    top: 100%; 
    left: 0; 
    right: 0; 
    border: 1px solid #ccc; 
    background: white; 
    max-height: 150px; 
    overflow-y: auto; 
    z-index: 1000; 
  }
  #suggestions div {
    padding: 8px;
    cursor: pointer;
  }
  #suggestions div:hover {
    background-color: #eee;
  }
  #selected-plants {
    margin-top: 10px;
  }
  #selected-plants span {
    display: inline-block;
    background-color: #d0f0d0;
    border: 1px solid #90c090;
    border-radius: 3px;
    padding: 3px 8px;
    margin: 3px 5px 3px 0;
    cursor: default;
  }
  #selected-plants span .remove-plant {
    margin-left: 8px;
    color: #a00;
    font-weight: bold;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>PhytoFinder</h1>

<div class="plants">
  <h2>Select Plants</h2>
  <div id="search-container">
    <input type="text" id="plant-search" placeholder="Search plants..." autocomplete="off" />
    <div id="suggestions" style="display:none;"></div>
  </div>
  <div id="selected-plants"></div>
  <button id="find-common">Find Common Chemicals</button>
</div>

<div class="results" id="results"></div>

<script>
  // chemicalList defines the master list of chemicals, in a specific order.
  // Each index in this array corresponds to a column in the plantMatrix.
  const chemicalList = [
    "Linalool", "Eugenol", "Camphor", "Thymol",
    "Menthol", "Citral", "Myrcene", "Geraniol",
    "Pinene", "Carvacrol"
  ];

  // plantMatrix maps each plant to an array of 0s and 1s, where each position
  // corresponds to the presence (1) or absence (0) of the chemical at that index
  // in chemicalList. This acts as a binary "fingerprint" for each plant.
  const plantMatrix = {
    Basil:    [1,1,0,0,0,0,0,0,0,0],
    Lavender: [1,0,1,0,0,0,0,0,0,0],
    Thyme:    [0,0,0,1,0,0,0,0,0,0],
    Mint:     [1,0,0,0,1,0,0,0,0,0],
    Oregano:  [1,0,0,0,0,0,0,0,0,1],
    Rosemary: [0,1,0,0,0,0,0,0,1,0],
    Sage:     [1,0,0,0,0,0,1,0,0,0]
  };

  const plants = Object.keys(plantMatrix);
  const selectedPlants = [];

  const plantSearchInput = document.getElementById("plant-search");
  const suggestionsDiv = document.getElementById("suggestions");
  const selectedPlantsDiv = document.getElementById("selected-plants");

  function renderSelectedPlants() {
    selectedPlantsDiv.innerHTML = "";
    selectedPlants.forEach(plant => {
      const span = document.createElement("span");
      span.textContent = plant;
      const removeBtn = document.createElement("span");
      removeBtn.textContent = "Ã—";
      removeBtn.className = "remove-plant";
      removeBtn.title = "Remove";
      removeBtn.addEventListener("click", () => {
        const index = selectedPlants.indexOf(plant);
        if (index > -1) {
          selectedPlants.splice(index, 1);
          renderSelectedPlants();
        }
      });
      span.appendChild(removeBtn);
      selectedPlantsDiv.appendChild(span);
    });
  }

  // currentMatches holds the filtered list of plant search suggestions
  // that match the user's input and are not already selected.
  let currentMatches = [];
  plantSearchInput.addEventListener("input", () => {
    const query = plantSearchInput.value.trim().toLowerCase();
    if (!query) {
      suggestionsDiv.style.display = "none";
      suggestionsDiv.innerHTML = "";
      currentMatches = [];
      return;
    }

    // Filter plants by input query, excluding those already selected.
    currentMatches = plants.filter(plant => plant.toLowerCase().startsWith(query) && !selectedPlants.includes(plant)).slice(0, 5);

    if (currentMatches.length === 0) {
      suggestionsDiv.style.display = "none";
      suggestionsDiv.innerHTML = "";
      return;
    }

    // Render suggestions as clickable divs.
    suggestionsDiv.innerHTML = currentMatches.map(plant => `<div>${plant}</div>`).join("");
    suggestionsDiv.style.display = "block";
  });

  // Allow selecting the first suggestion by pressing Enter.
  plantSearchInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && currentMatches && currentMatches.length > 0) {
      const selectedPlant = currentMatches[0];
      if (!selectedPlants.includes(selectedPlant)) {
        selectedPlants.push(selectedPlant);
        renderSelectedPlants();
      }
      // Clear search and hide suggestions
      plantSearchInput.value = "";
      suggestionsDiv.style.display = "none";
      suggestionsDiv.innerHTML = "";
      plantSearchInput.focus();
      // Prevent form submission or default Enter behavior
      e.preventDefault();
    }
  });

  // Handle clicking a suggestion to select a plant.
  suggestionsDiv.addEventListener("click", (e) => {
    if (e.target && e.target.nodeName === "DIV") {
      const selectedPlant = e.target.textContent;
      if (!selectedPlants.includes(selectedPlant)) {
        selectedPlants.push(selectedPlant);
        renderSelectedPlants();
      }
      // Clear search and hide suggestions
      plantSearchInput.value = "";
      suggestionsDiv.style.display = "none";
      suggestionsDiv.innerHTML = "";
      plantSearchInput.focus();
    }
  });

  // Hide suggestions if clicking outside the search container.
  document.addEventListener("click", (e) => {
    if (!document.getElementById("search-container").contains(e.target)) {
      suggestionsDiv.style.display = "none";
      suggestionsDiv.innerHTML = "";
    }
  });

  /**
   * Finds chemicals shared by all selected plants.
   * For each chemical (by index), checks if all selected plants have a 1 for that chemical.
   * Uses bitwise intersection: ANDs each plant's chemical array together,
   * resulting in 1 only where all selected plants have 1.
   * Filters chemicalList to include only chemicals present in all selected plants.
   *
   * @param {string[]} selectedPlants - Array of selected plant names.
   * @returns {string[]} Array of chemical names present in all selected plants.
   */
  function findSharedChemicals(selectedPlants) {
    if (selectedPlants.length === 0) return [];

    // Start with the chemical array of the first plant.
    let shared = [...plantMatrix[selectedPlants[0]]];
    // For each subsequent plant, perform a bitwise AND for each chemical.
    for (let i = 1; i < selectedPlants.length; i++) {
      let current = plantMatrix[selectedPlants[i]];
      shared = shared.map((bit, idx) => bit & current[idx]);
    }
    // Return chemical names where the resulting shared array has a 1.
    return chemicalList.filter((_, i) => shared[i] === 1);
  }

  // When the user clicks the "Find Common Chemicals" button,
  // calculate and display the shared chemicals among the selected plants.
  document.getElementById("find-common").addEventListener("click", () => {
    const commonChemicals = findSharedChemicals(selectedPlants);

    const resultsDiv = document.getElementById("results");
    if (commonChemicals.length === 0) {
      resultsDiv.textContent = "No common chemicals found among the selected plants.";
    } else {
      resultsDiv.innerHTML = "<h3>Common Chemicals:</h3><ul>" +
        commonChemicals.map(c => `<li>${c}</li>`).join("") +
        "</ul>";
    }
  });
</script>

</body>
</html>
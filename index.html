<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PhytoFinder</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');

  body {
    font-family: 'Inter', Arial, sans-serif;
    max-width: 600px;
    margin: 50px auto;
    background-color: #f9faf9;
    color: #2f3e46;
    padding: 0 20px 40px;
  }

  h1 {
    text-align: center;
    font-weight: 300;
    letter-spacing: 1.2px;
    margin-bottom: 0.3em;
    color: #1b4332;
  }

  h2 {
    font-weight: 300;
    letter-spacing: 0.8px;
    color: #344e41;
    margin-bottom: 15px;
  }

  .plants, .results {
    margin-top: 30px;
  }

  label {
    display: block;
    margin: 8px 0;
    cursor: pointer;
    color: #344e41;
  }

  #search-container {
    position: relative;
  }

  #plant-search {
    width: 100%;
    padding: 12px 16px;
    font-size: 1rem;
    box-sizing: border-box;
    border: 1.8px solid #a7c4a0;
    border-radius: 10px;
    outline-offset: 2px;
    outline-color: #6a994e;
    background-color: #f0f5f1;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 1px 4px rgba(106, 153, 78, 0.15);
  }
  #plant-search:focus {
    border-color: #52734d;
    box-shadow: 0 0 8px rgba(82, 115, 77, 0.5);
    background-color: #e6f0e8;
  }

  #suggestions {
    position: absolute;
    top: 110%;
    left: 0;
    right: 0;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    max-height: 180px;
    overflow-y: auto;
    z-index: 1000;
    padding: 8px 0;
  }
  #suggestions div {
    padding: 10px 20px;
    cursor: pointer;
    color: #344e41;
    font-weight: 500;
    transition: background-color 0.25s ease, color 0.25s ease;
  }
  #suggestions div:hover {
    background-color: #d1e7c2;
    color: #1b4332;
  }

  button {
    margin-top: 25px;
    padding: 12px 25px;
    font-size: 1.1rem;
    font-weight: 600;
    color: #f0f5f1;
    background-color: #52734d;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(82, 115, 77, 0.4);
    transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.15s ease;
  }
  button:hover {
    background-color: #3e5c34;
    box-shadow: 0 8px 20px rgba(62, 92, 52, 0.6);
    transform: translateY(-2px);
  }
  button:active {
    transform: translateY(0);
    box-shadow: 0 4px 10px rgba(62, 92, 52, 0.5);
  }

  .results {
    font-weight: 500;
    color: #344e41;
    margin-top: 35px;
  }
  .results h3 {
    font-weight: 400;
    color: #52734d;
    margin-bottom: 12px;
    letter-spacing: 0.5px;
  }
  .results ul {
    padding-left: 20px;
    color: #344e41;
  }
  .results li {
    margin-bottom: 6px;
  }
</style>
</head>
<body>

<h1>PhytoFinder</h1>

<div class="plants">
  <h2>Select Plants</h2>
  <div id="search-container">
    <input type="text" id="plant-search" placeholder="Search plants..." autocomplete="off" />
    <div id="suggestions" style="display:none;"></div>
  </div>
</div>

<div class="results" id="results"></div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
  const plantData = {};

  Papa.parse("data/scientific_names.csv", {
    download: true,
    header: true,
    complete: (results) => {
      results.data.forEach(entry => {
        const fnf = Number(entry.FNFNUM);
        plantData[fnf] = {
          scientific: `${entry.Genus} ${entry.Species}`,
          common: [] // weâ€™ll fill this in next
        };
      });
      console.log("Loaded plantData from CSV:", plantData);
    }
  });

  const plantSearchInput = document.getElementById("plant-search");
  const suggestionsDiv = document.getElementById("suggestions");
  const resultsDiv = document.getElementById("results");

  // To hold current matches for keyboard selection
  let currentMatches = [];

  plantSearchInput.addEventListener("input", () => {
    const query = plantSearchInput.value.trim().toLowerCase();
    if (!query) {
      suggestionsDiv.style.display = "none";
      suggestionsDiv.innerHTML = "";
      currentMatches = [];
      return;
    }

    // Filter plantData by scientific name matching the query
    currentMatches = Object.values(plantData)
      .filter(plant => plant.scientific.toLowerCase().startsWith(query))
      .slice(0, 5);

    if (currentMatches.length === 0) {
      suggestionsDiv.style.display = "none";
      suggestionsDiv.innerHTML = "";
      return;
    }

    // Render suggestions as clickable divs showing scientific names
    suggestionsDiv.innerHTML = currentMatches.map(plant => `<div>${plant.scientific}</div>`).join("");
    suggestionsDiv.style.display = "block";
  });

  // When user presses Enter, select the first suggestion and show in results
  plantSearchInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && currentMatches.length > 0) {
      const selectedPlant = currentMatches[0];
      displayPlantInfo(selectedPlant);
      plantSearchInput.value = "";
      suggestionsDiv.style.display = "none";
      suggestionsDiv.innerHTML = "";
      plantSearchInput.focus();
      e.preventDefault();
    }
  });

  // When user clicks a suggestion, show that plant info in results
  suggestionsDiv.addEventListener("click", (e) => {
    if (e.target && e.target.nodeName === "DIV") {
      const selectedName = e.target.textContent;
      const selectedPlant = currentMatches.find(p => p.scientific === selectedName);
      if (selectedPlant) {
        displayPlantInfo(selectedPlant);
      }
      plantSearchInput.value = "";
      suggestionsDiv.style.display = "none";
      suggestionsDiv.innerHTML = "";
      plantSearchInput.focus();
    }
  });

  // Hide suggestions if clicking outside the search container
  document.addEventListener("click", (e) => {
    if (!document.getElementById("search-container").contains(e.target)) {
      suggestionsDiv.style.display = "none";
      suggestionsDiv.innerHTML = "";
    }
  });

  function displayPlantInfo(plant) {
    resultsDiv.innerHTML = `<h3>Selected Plant:</h3><p>${plant.scientific}</p>`;
  }
</script>
</body>
</html>